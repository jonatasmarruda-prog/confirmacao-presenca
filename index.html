<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Confirmação de Presença</title>
<style>
body { font-family: Arial; background:#000; color:#fff; padding:20px; margin:0;}
.container { max-width:600px; margin:auto;}
h2 { text-align:center; font-size:3em; margin-bottom:20px;}
button.nome { display:block; width:100%; padding:30px 0; margin:10px 0; font-size:2em; border:none; border-radius:12px; cursor:pointer; transition:background-color 0.3s;}
.presente { background:#00ff00; color:#000;}
.faltante { background:#333; color:#fff;}
.stats { text-align:center; margin-bottom:20px; font-size:1.8em;}
#secretBtn { font-size:0.9em; background:none; border:none; color:#555; text-align:center; cursor:pointer; margin-bottom:10px; }
#painelFinal { display:none; background:#111; padding:15px; border-radius:10px; margin-top:20px;}
#painelFinal h3 { text-align:center;}
#painelFinal .listaBloco { margin-bottom:15px; }
#painelFinal ul { list-style:none; padding:0; margin:0; }
#painelFinal li.presente { color:#00ff00; }
#painelFinal li.faltante { color:#aaa; }
#baixarCSV { display:block; margin:10px auto; padding:10px 20px; font-size:16px; border-radius:6px; cursor:pointer; }
</style>
</head>
<body>
<div class="container">
<h2>Confirmação de Presença</h2>

<button id="secretBtn">Clique aqui (secreto)</button>

<div class="stats">
<span id="totalConfirmados">Confirmados: 0</span> |
<span id="totalFaltantes">Faltantes: 0</span>
</div>

<div id="lista"></div>

<div id="painelFinal">
<h3>Resumo Final</h3>
<div class="listaBloco">
<h4>Presentes</h4>
<ul id="listaPresentes"></ul>
</div>
<div class="listaBloco">
<h4>Faltantes</h4>
<ul id="listaFaltantes"></ul>
</div>
<button id="baixarCSV">Baixar CSV</button>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getDatabase, ref, set, onValue, get } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

const firebaseConfig = { databaseURL: "https://trilheirosroo-a5861-default-rtdb.firebaseio.com/" };
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const listaRef = ref(db, "presenca");

let nomes = ["Lais","Pedro","Francielly","Yasmim","Allline","Daniella","Yasmim marques","Diego","Dorcas","Evelin","Samara","Mickalele","Paula","Diego Henrique","Ewverton","Aline","Any","Gleici","Thais","Regiane","Marinalva","Jessica","Cleverson","Elizabeth","Suely","Josueu","Heber","Ana Carolina","Vanessa","Raquel","Sandra","Josevaldo","Saul","Joao Batista","Mariana","Beatriz","Elaine","Janaina","Denise","Thais","Daniele","Daniela","Eloah","Valteli","Loanna","Lucas"];
nomes.sort((a,b)=>a.localeCompare(b,'pt'));

let estadosAtuais = {};

// Inicializa nomes no Firebase se não existir
get(listaRef).then(snapshot=>{
    if(!snapshot.exists()){
        const inicial = {};
        nomes.forEach(n=>inicial[n]=false);
        set(listaRef,inicial);
    }
});

function atualizarLista(estados){
    estadosAtuais = estados || {};
    const lista = document.getElementById("lista");
    lista.innerHTML="";
    let confirmados=0, faltantes=0;
    nomes.forEach(nome=>{
        const btn = document.createElement("button");
        btn.textContent = nome;
        btn.className="nome "+(estadosAtuais[nome]?"presente":"faltante");
        btn.onclick=()=>{ set(ref(db,"presenca/"+nome),!estadosAtuais[nome]); };
        lista.appendChild(btn);
        estadosAtuais[nome]?confirmados++:faltantes++;
    });
    document.getElementById("totalConfirmados").textContent="Confirmados: "+confirmados;
    document.getElementById("totalFaltantes").textContent="Faltantes: "+faltantes;
}

function atualizarPainelFinal(){
    const ulPres = document.getElementById("listaPresentes");
    const ulFalt = document.getElementById("listaFaltantes");
    ulPres.innerHTML=""; ulFalt.innerHTML="";
    nomes.forEach(nome=>{
        const li=document.createElement("li");
        li.textContent=nome;
        if(estadosAtuais[nome]){
            li.className="presente";
            ulPres.appendChild(li);
        } else {
            li.className="faltante";
            ulFalt.appendChild(li);
        }
    });
}

onValue(listaRef, snapshot=>{
    estadosAtuais=snapshot.val()||{};
    atualizarLista(estadosAtuais);
    atualizarPainelFinal();
});

document.getElementById("secretBtn").onclick=()=>{
    const painel=document.getElementById("painelFinal");
    painel.style.display=painel.style.display==="none"?"block":"none";
    document.getElementById("secretBtn").style.color="#0f0"; 
};

document.getElementById("baixarCSV").onclick=()=>{
    let csv="Nome,Presença\n";
    nomes.forEach(nome=>{ csv+=nome+","+(estadosAtuais[nome]?"Presente":"Faltante")+"\n"; });
    const blob=new Blob([csv],{type:"text/csv"});
    const url=URL.createObjectURL(blob);
    const a=document.createElement("a");
    a.href=url; a.download="resumo_presenca.csv"; a.click(); URL.revokeObjectURL(url);
};
</script>
</body>
</html>


