<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Confirmação de Presença</title>
<style>
body { font-family: Arial; background:#000; color:#fff; padding:20px; margin:0;}
.container { max-width:600px; margin:auto;}
h2 { text-align:center; font-size:3em; margin-bottom:20px;}
button.nome { display:block; width:100%; padding:30px 0; margin:10px 0; font-size:2em; border:none; border-radius:12px; cursor:pointer; transition:background-color 0.3s;}
.presente { background:#00ff00; color:#000;}
.faltante { background:#333; color:#fff;}
.stats { text-align:center; margin-bottom:20px; font-size:1.8em;}

#painelFinal { display:none; background:#111; padding:15px; border-radius:10px; margin-top:20px;}
#painelFinal h3 { text-align:center;}
#painelFinal .listaBloco { margin-bottom:15px; }
#painelFinal ul { list-style:none; padding:0; margin:0; }
#painelFinal li.presente { color:#00ff00; }
#painelFinal li.faltante { color:#aaa; }

#btnVerConfirmados {
    display:block;
    width:100%;
    padding:15px 0;
    font-size:1.5em;
    border:none;
    border-radius:12px;
    cursor:pointer;
    background:#0066ff;
    color:#fff;
    margin-bottom:15px;
}

#btnZerar {
    display:block;
    margin:10px auto;
    padding:10px 20px;
    font-size:16px;
    border-radius:6px;
    cursor:pointer;
    background:#ff0000;
    color:#fff;
}

#baixarCSV { display:block; margin:10px auto; padding:10px 20px; font-size:16px; border-radius:6px; cursor:pointer; }
</style>
</head>
<body>
<div class="container">
<h2>Confirmação de Presença</h2>

<button id="btnVerConfirmados">Ver Geral</button>

<div class="stats">
<span id="totalConfirmados">Confirmados: 0</span> |
<span id="totalFaltantes">Faltantes: 0</span>
</div>

<div id="lista"></div>

<div id="painelFinal">
<h3>Resumo em Tempo Real</h3>

<div class="listaBloco">
<h4>Presentes</h4>
<ul id="listaPresentes"></ul>
</div>

<div class="listaBloco">
<h4>Faltantes</h4>
<ul id="listaFaltantes"></ul>
</div>

<button id="baixarCSV">Baixar CSV</button>
<button id="btnZerar">Zerar Confirmações</button>
</div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getDatabase, ref, set, onValue, get } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

const firebaseConfig = { databaseURL: "https://trilheirosroo-a5861-default-rtdb.firebaseio.com/" };
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const listaRef = ref(db, "presenca");

let nomes = [
"Aline","Allline","Ana Carolina","Any","Beatriz","Cleverson","Daniela","Daniele","Daniella","Denise",
"Diego","Diego Henrique","Dorcas","Elaine","Eloah","Elizabeth","Evelin","Ewverton","Francielly",
"Gleici","Heber","Janaina","Jessica","Joao Batista","Josevaldo","Josueu","Lais","Loanna","Lucas",
"Mariana","Marinalva","Mickalele","Paula","Pedro","Raquel","Regiane","Samara","Sandra","Saul",
"Suely","Thais","Thais","Valteli","Vanessa","Yasmim","Yasmim Marques"
];

nomes.sort((a,b)=>a.localeCompare(b,"pt",{sensitivity:"base"}));

let estadosAtuais = {};

get(listaRef).then(snapshot=>{
    if(!snapshot.exists()){
        const inicial = {};
        nomes.forEach(n=>inicial[n]=false);
        set(listaRef,inicial);
    }
});

function atualizarLista(estados){
    estadosAtuais = estados || {};
    const lista = document.getElementById("lista");
    lista.innerHTML="";
    let confirmados=0, faltantes=0;
    nomes.forEach(nome=>{
        const btn = document.createElement("button");
        btn.textContent = nome;
        btn.className="nome "+(estadosAtuais[nome]?"presente":"faltante");
        btn.onclick=()=>{ set(ref(db,"presenca/"+nome),!estadosAtuais[nome]); };
        lista.appendChild(btn);
        estadosAtuais[nome]?confirmados++:faltantes++;
    });
    document.getElementById("totalConfirmados").textContent="Confirmados: "+confirmados;
    document.getElementById("totalFaltantes").textContent="Faltantes: "+faltantes;
}

function atualizarPainelFinal(){
    const ulPres = document.getElementById("listaPresentes");
    const ulFalt = document.getElementById("listaFaltantes");
    ulPres.innerHTML="";
    ulFalt.innerHTML="";
    nomes.forEach(nome=>{
        const li=document.createElement("li");
        li.textContent=nome;
        if(estadosAtuais[nome]){
            li.className="presente";
            ulPres.appendChild(li);
        } else {
            li.className="faltante";
            ulFalt.appendChild(li);
        }
    });
}

onValue(listaRef, snapshot=>{
    estadosAtuais=snapshot.val()||{};
    atualizarLista(estadosAtuais);
    atualizarPainelFinal();
});

document.getElementById("btnVerConfirmados").onclick=()=>{
    document.getElementById("painelFinal").style.display="block";
};

document.getElementById("btnZerar").onclick=()=>{
    if(confirm("Tem certeza que deseja zerar tudo?")){
        const zerado={};
        nomes.forEach(n=>zerado[n]=false);
        set(listaRef,zerado);
    }
};

document.getElementById("baixarCSV").onclick=()=>{
    let csv="Nome,Presença\n";
    nomes.forEach(nome=>{ csv+=nome+","+(estadosAtuais[nome]?"Presente":"Faltante")+"\n"; });
    const blob=new Blob([csv],{type:"text/csv"});
    const url=URL.createObjectURL(blob);
    const a=document.createElement("a");
    a.href=url; a.download="resumo_presenca.csv"; a.click(); URL.revokeObjectURL(url);
};
</script>
</body>
</html>


