<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Painel do Organizador</title>

<style>
  body {
    background:#0d0d0d;
    color:white;
    font-family: system-ui;
    padding:20px;
  }
  h1 { text-align:center; }
  .card {
    background:#1a1a1a;
    padding:16px;
    border-radius:12px;
    margin-bottom:16px;
  }
  .btn {
    padding:12px;
    border:0;
    border-radius:8px;
    font-size:16px;
    font-weight:bold;
    cursor:pointer;
    margin-top:12px;
    width:100%;
  }
  .btn-green { background:#16a34a; color:#fff; }
  .btn-red { background:#dc2626; color:#fff; }
  .btn-blue { background:#2563eb; color:#fff; }
  table {
    width:100%;
    border-collapse: collapse;
    margin-top:16px;
    font-size:16px;
  }
  th, td {
    padding:8px;
    border-bottom:1px solid #333;
  }
  th { text-align:left; }
  .hidden { display:none; }
</style>

</head>
<body>

<h1>Painel do Organizador üîê</h1>

<div id="loginBox" class="card">
  <h3>Digite a senha do organizador</h3>
  <input id="senha" type="password" style="width:100%;padding:10px;border-radius:8px;border:0;">
  <button class="btn btn-blue" onclick="login()">Entrar</button>
</div>

<div id="content" class="hidden">

  <div class="card">
    <h2>üìä Resumo do Evento</h2>
    <p>Total: <b id="total"></b></p>
    <p>Confirmados: <b id="confirmados"></b></p>
    <p>Faltantes: <b id="faltantes"></b></p>
  </div>

  <div class="card">
    <h2>üìã Lista de Participantes</h2>
    <table id="tabela"></table>
  </div>

  <div class="card">
    <h2>üì• Exporta√ß√µes</h2>
    <button class="btn btn-blue" onclick="exportarPDF()">Gerar PDF</button>
    <button class="btn btn-green" onclick="exportarWhatsApp()">Enviar Confirmados no WhatsApp</button>
  </div>

  <div class="card">
    <h2>üßπ Administra√ß√£o</h2>
    <button class="btn btn-red" onclick="resetar()">RESETAR LISTA (Zerar confirma√ß√µes)</button>
  </div>

</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// === CONFIG DO SEU FIREBASE ===
const firebaseConfig = {
  apiKey: "AIzaSyAUssjdtiOs0oO9yhWV3dExsj7sGaB4jEA",
  authDomain: "onibus-morro-da-mesa.firebaseapp.com",
  databaseURL: "https://onibus-morro-da-mesa-default-rtdb.firebaseio.com",
  projectId: "onibus-morro-da-mesa",
  storageBucket: "onibus-morro-da-mesa.firebasestorage.app",
  messagingSenderId: "21597144482",
  appId: "1:21597144482:web:93a55c39d477e67c1d5efb",
  measurementId: "G-WP1BX1H1F0"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const ref = db.ref("presenca_onibus");

const listaNomes = [];

// === LOGIN SIMPLES ===
function login(){
  const s = document.getElementById("senha").value;
  if(s === "trilheiros2025"){      
    document.getElementById("loginBox").classList.add("hidden");
    document.getElementById("content").classList.remove("hidden");
  } else {
    alert("Senha incorreta!");
  }
}

// === CARREGA LISTA ===
ref.on("value", snap => {
  const data = snap.val();
  if(!data) return;

  render(data);
});

function render(data){
  const nomes = Object.keys(data);
  const confirmados = nomes.filter(n => data[n]).length;
  const faltantes = nomes.length - confirmados;

  document.getElementById("total").innerText = nomes.length;
  document.getElementById("confirmados").innerText = confirmados;
  document.getElementById("faltantes").innerText = faltantes;

  // tabela
  const table = document.getElementById("tabela");
  table.innerHTML = `
    <tr><th>Nome</th><th>Status</th></tr>
  `;

  nomes.forEach(n=>{
    table.innerHTML += `
      <tr>
        <td>${n}</td>
        <td>${data[n] ? "‚úÖ Confirmado" : "‚ùå N√£o"}</td>
      </tr>
    `;
  });
}

// === EXPORTAR PDF ===
function exportarPDF(){
  const w = window.open("", "_blank");
  w.document.write("<h1>Relat√≥rio do Passeio</h1>");
  w.document.write(document.getElementById("tabela").outerHTML);
  w.print();
}

// === EXPORTAR WHATSAPP ===
function exportarWhatsApp(){
  ref.once("value", snap => {
    const data = snap.val();
    const nomesConfirmados = Object.keys(data).filter(n => data[n]);
    const texto = `Confirmados (%20${nomesConfirmados.length}%20pessoas):%0A- ` 
                + nomesConfirmados.join("%0A- ");

    window.open(`https://wa.me/5566996926174?text=${texto}`, "_blank");
  });
}

// === RESET ===
function resetar(){
  if(!confirm("Tem certeza que deseja resetar TUDO?")) return;

  ref.once("value", snap => {
    const data = snap.val();
    const novo = {};
    Object.keys(data).forEach(n => novo[n] = false);
    ref.set(novo);
  });
}
</script>

</body>
</html>
