<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Lista de Presença - Ônibus</title>
  <style>
    :root{
      --bg:#0d0d0d;--card:#1a1a1a;--accent:#16a34a;--danger:#dc2626;--muted:#aaa;
    }
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:0;background:var(--bg);color:white}
    .app{max-width:720px;margin:0 auto;padding:16px}
    header{display:flex;flex-direction:column;align-items:center;gap:12px}
    h1{font-size:22px;margin:0}
    .status{margin-top:12px;display:flex;gap:8px;flex-wrap:wrap}
    .chip{background:var(--card);padding:8px 12px;border-radius:12px;font-weight:600;box-shadow:0 1px 2px rgba(0,0,0,0.4)}
    .controls{display:flex;gap:8px;margin-top:12px}
    button.btn{flex:1;padding:12px;border-radius:10px;border:0;font-size:16px;font-weight:700;cursor:pointer}
    .btn-all{background:#232323;color:white}
    .btn-confirm{background:var(--accent);color:white}
    .btn-missing{background:var(--danger);color:white}
    .list{margin-top:14px;background:var(--card);border-radius:12px;padding:8px;box-shadow:0 6px 18px rgba(0,0,0,0.5)}
    .item{display:flex;align-items:center;justify-content:space-between;padding:12px;border-bottom:1px solid rgba(255,255,255,0.06)}
    .item:last-child{border-bottom:0}
    .name{font-size:18px;font-weight:700}
    .confirm-btn{padding:10px 14px;border-radius:10px;border:0;font-weight:700;cursor:pointer}
    .confirmed{background:#16a34a;color:white}
    .not-confirmed{background:transparent;border:2px dashed #555;color:white}
    footer{text-align:center;margin-top:16px;color:var(--muted)}
  </style>
</head>
<body>

<div style="text-align:center;margin-top:12px;">
  <img src="https://i.imgur.com/MwHr761.png" style="width:130px;">
</div>

<div class="app">
  <header>
    <h1>Lista de Presença - Ônibus</h1>
  </header>

  <div class="status">
    <div class="chip" id="total">Total: 0</div>
    <div class="chip" id="confirmedCount">Confirmados: 0</div>
    <div class="chip" id="missingCount">Faltantes: 0</div>
  </div>

  <div class="controls">
    <button class="btn btn-all" id="showAll">Ver todos</button>
    <button class="btn btn-confirm" id="showConfirmed">Confirmados</button>
    <button class="btn btn-missing" id="showMissing">Faltantes</button>
  </div>

  <div class="list" id="list"></div>

  <footer>Toque no nome para confirmar. Atualização em tempo real.</footer>

  <div style="text-align:center;margin-top:20px;">
    <button id="resetBtn" style="padding:10px 14px;border-radius:8px;border:0;background:#333;color:white;">
      Resetar lista
    </button>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAUssjdtiOs0oO9yhWV3dExsj7sGaB4jEA",
  authDomain: "onibus-morro-da-mesa.firebaseapp.com",
  databaseURL: "https://onibus-morro-da-mesa-default-rtdb.firebaseio.com",
  projectId: "onibus-morro-da-mesa",
  storageBucket: "onibus-morro-da-mesa.firebasestorage.app",
  messagingSenderId: "21597144482",
  appId: "1:21597144482:web:93a55c39d477e67c1d5efb",
  measurementId: "G-WP1BX1H1F0"
};

const app = firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const dbRef = db.ref("presenca_onibus");

const names = [
  "Alysson","Ana Julia","Debora Betania","Debora Carla","Edivaldo","Eliana","Elizangela",
  "Elma","Fagner","Flavia Yane","Gabriellen","Indrid Mirely","Isadora","Izabel","Izabelly",
  "Jessica","Jessica Lorrayne","Joana","Jonatas Marcos","Josiane","Junior","Livia","Lucas",
  "Luciana","Luciene","Maria Nemis","Maria Rafaela","Maria luisa","Nadir","Nayhany","Paula",
  "Paula Francinete","Shely","Silvânia","Tamiris","Tatielen","Thaynan","Vitoria","Wallison",
  "Ivy"
];

document.getElementById("total").textContent = "Total: " + names.length;

dbRef.once("value").then(snap=>{
  if(!snap.exists()){
    const init={}; names.forEach(n=>init[n]=false);
    dbRef.set(init);
  }
});

let last={};

dbRef.on("value", snap=>{
  last = snap.val();
  render(last);
});

function toggle(n){
  dbRef.child(n).set(!last[n]);
}

function render(data){
  const listEl = document.getElementById("list");
  const filter = listEl.getAttribute("data-filter") || "all";

  const confirmed = names.filter(n=>data[n]).length;
  document.getElementById("confirmedCount").textContent = "Confirmados: "+confirmed;
  document.getElementById("missingCount").textContent = "Faltantes: "+(names.length-confirmed);

  listEl.innerHTML = "";

  names.forEach(n=>{
    const ok = data[n];

    if(filter==="confirmed" && !ok) return;
    if(filter==="missing" && ok) return;

    listEl.innerHTML += `
      <div class="item">
        <div class="name">${n}</div>
        <button class="confirm-btn ${ok?'confirmed':'not-confirmed'}" onclick="toggle('${n}')">
          ${ok?'Confirmado':'Confirmar'}
        </button>
      </div>
    `;
  });
}

document.getElementById("showAll").onclick=()=>{document.getElementById("list").setAttribute("data-filter","all");render(last);};
document.getElementById("showConfirmed").onclick=()=>{document.getElementById("list").setAttribute("data-filter","confirmed");render(last);};
document.getElementById("showMissing").onclick=()=>{document.getElementById("list").setAttribute("data-filter","missing");render(last);};

document.getElementById("resetBtn").onclick=()=>{
  if(confirm("Zerar confirmações?")){
    const init={}; names.forEach(n=>init[n]=false);
    dbRef.set(init);
  }
};
</script>

</body>
</html>
