<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Confirma√ß√£o de Presen√ßa - √înibus</title>
  <style>
    :root{
      --bg:#0b0b0c;
      --card:#121215;
      --accent:#16a34a;
      --danger:#dc2626;
      --muted:#9aa0a6;
      --text:#ffffff;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;background:var(--bg);color:var(--text)}
    .app{max-width:780px;margin:0 auto;padding:16px}
    header{display:flex;align-items:center;gap:12px;flex-direction:column}
    h1{font-size:20px;margin:6px 0}
    .logo{width:120px;border-radius:8px}
    .status{margin-top:12px;display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
    .chip{background:var(--card);padding:8px 12px;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,0.6);font-weight:700;color:var(--text)}
    .controls{display:flex;gap:8px;margin-top:12px;justify-content:space-between}
    button.btn{flex:1;padding:12px;border-radius:10px;border:0;font-size:15px;font-weight:700;cursor:pointer}
    .btn-all{background:#141416;color:var(--text);border:1px solid #1f1f1f}
    .btn-confirm{background:var(--accent);color:#fff}
    .btn-missing{background:var(--danger);color:#fff}
    .list{margin-top:14px;background:var(--card);border-radius:12px;padding:6px;box-shadow:0 8px 24px rgba(0,0,0,0.6)}
    .item{display:flex;align-items:center;justify-content:space-between;padding:12px;border-bottom:1px solid rgba(255,255,255,0.03)}
    .item:last-child{border-bottom:0}
    .name{font-size:17px;font-weight:800}
    .small{font-size:13px;color:var(--muted)}
    .confirm-btn{padding:10px 14px;border-radius:10px;border:0;font-weight:800;cursor:pointer}
    .confirmed{background:linear-gradient(90deg,#16a34a,#059669);color:#fff}
    .not-confirmed{background:transparent;border:2px dashed rgba(255,255,255,0.06);color:var(--text)}
    footer{margin-top:12px;text-align:center;color:var(--muted);font-size:13px}
    .top-row{width:100%;display:flex;gap:8px;align-items:center}
    .hidden-reset{opacity:0.0;height:1px;width:1px;border:0;padding:0;margin:0}
    @media(min-width:640px){h1{font-size:22px}}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <img class="logo" id="logoImg" src="https://i.imgur.com/MwHr761.png" alt="Logo Trilheiros" />
      <h1>Confirmar presen√ßa - √înibus</h1>
      <div class="small">Toque no seu nome para confirmar. Atualiza√ß√£o em tempo real üîÑ</div>
    </header>

    <div class="status" role="status" aria-live="polite">
      <div class="chip" id="total">Total: 0</div>
      <div class="chip" id="confirmedCount">Confirmados: 0</div>
      <div class="chip" id="missingCount">Faltantes: 0</div>
    </div>

    <div class="controls" style="margin-top:12px;">
      <button class="btn btn-all" id="showAll">Ver todos</button>
      <button class="btn btn-confirm" id="showConfirmed">Ver confirmados</button>
      <button class="btn btn-missing" id="showMissing">Ver faltantes</button>
    </div>

    <div class="list" id="list" aria-live="polite" style="margin-bottom:10px;"></div>

    <footer>
      Use com seu celular ‚Äî compartilhe o link para o grupo. Para sincronizar entre celulares precisa manter este projeto Firebase ativo.
    </footer>

    <!-- Reset seguro -->
    <div style="margin-top:12px;text-align:center;">
      <button id="btnReset" style="padding:10px 12px;border-radius:8px;border:0;background:#222;color:#fff;cursor:pointer;">
        Resetar (digite RESET)
      </button>
    </div>
  </div>

  <!-- Firebase (compat libs para facilitar a integra√ß√£o em p√°ginas simples) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <script>
    /****************** CONFIGURA√á√ÉO FIREBASE (j√° fornecida por voc√™) ******************/
    const firebaseConfig = {
      apiKey: "AIzaSyAUssjdtiOs0oO9yhWV3dExsj7sGaB4jEA",
      authDomain: "onibus-morro-da-mesa.firebaseapp.com",
      databaseURL: "https://onibus-morro-da-mesa-default-rtdb.firebaseio.com",
      projectId: "onibus-morro-da-mesa",
      storageBucket: "onibus-morro-da-mesa.firebasestorage.app",
      messagingSenderId: "21597144482",
      appId: "1:21597144482:web:93a55c39d477e67c1d5efb",
      measurementId: "G-WP1BX1H1F0"
    };
    /***********************************************************************************/

    // === Lista com TODOS os 41 nomes (ordenados alfabeticamente) ===
    const names = [
      "Alysson","Ana Julia","Cidinha","Debora Betania","Debora Carla","Edivaldo","Eliana",
      "Elizangela","Elma","Fagner","Flavia Yane","Gabriellen","Indrid Mirely","Isadora",
      "Izabel","Izabelly","Jessica","Jessica Lorrayne","Joana","Jonatas Marcos","Josiane",
      "Junior","Livia","Lucas","Luciana","Luciene","Maria Nemis","Maria Rafaela","Maria luisa",
      "Nadir","Nayhany","Paula","Paula Francinete","Shely","Silv√¢nia","Tamiris","Tatielen",
      "Thaynan","Vitoria","Wallison","Ivy"
    ];
    // total
    const totalEl = document.getElementById('total');
    totalEl.textContent = `Total: ${names.length}`;

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const dbRef = db.ref('presenca_onibus');

    // UI elements
    const listEl = document.getElementById('list');
    const confirmedEl = document.getElementById('confirmedCount');
    const missingEl = document.getElementById('missingCount');
    const showAllBtn = document.getElementById('showAll');
    const showConfirmedBtn = document.getElementById('showConfirmed');
    const showMissingBtn = document.getElementById('showMissing');
    const btnReset = document.getElementById('btnReset');

    // Guarda o √∫ltimo estado recebido do Firebase
    let lastData = {};

    // Inicializa a estrutura no banco se ainda n√£o existir
    dbRef.once('value').then(snap => {
      if (!snap.exists()) {
        const initial = {};
        names.forEach(n => initial[n] = false);
        return dbRef.set(initial);
      }
    }).catch(err => {
      // se erro, apenas loga (mas o site ainda funciona com Firebase desconectado)
      console.log('Erro inicializando DB:', err);
    });

    // Ouve mudan√ßas em tempo real
    dbRef.on('value', snap => {
      const data = snap.val() || {};
      // garante que todas as chaves existam
      names.forEach(n => { if (typeof data[n] === 'undefined') data[n] = false; });
      lastData = data;
      renderList(data);
    });

    // Fun√ß√£o para alternar confirma√ß√£o (usa transaction para evitar conflitos)
    function toggle(name) {
      const node = dbRef.child(name);
      node.transaction(current => !current);
    }

    // Render da lista com filtro atual
    function renderList(dataMap) {
      const data = dataMap || lastData || {};
      const confirmedCount = names.filter(n => !!data[n]).length;
      const missingCount = names.length - confirmedCount;
      confirmedEl.textContent = `Confirmados: ${confirmedCount}`;
      missingEl.textContent = `Faltantes: ${missingCount}`;

      const filter = listEl.getAttribute('data-filter') || 'all';
      listEl.innerHTML = '';

      names.forEach(name => {
        const is = !!data[name];
        if (filter === 'confirmed' && !is) return;
        if (filter === 'missing' && is) return;

        const item = document.createElement('div');
        item.className = 'item';

        const left = document.createElement('div');
        left.innerHTML = `<div class="name">${name}</div><div class="small">${is ? 'Confirmado' : ''}</div>`;

        const actions = document.createElement('div');
        const btn = document.createElement('button');
        btn.className = 'confirm-btn ' + (is ? 'confirmed' : 'not-confirmed');
        btn.textContent = is ? 'Confirmado' : 'Confirmar';
        btn.onclick = () => toggle(name);

        actions.appendChild(btn);
        item.appendChild(left);
        item.appendChild(actions);
        listEl.appendChild(item);
      });
    }

    // Filtros (usam lastData j√° carregado)
    showAllBtn.onclick = () => { listEl.setAttribute('data-filter', 'all'); renderList(lastData); };
    showConfirmedBtn.onclick = () => { listEl.setAttribute('data-filter', 'confirmed'); renderList(lastData); };
    showMissingBtn.onclick = () => { listEl.setAttribute('data-filter', 'missing'); renderList(lastData); };

    // Reset seguro: pede digitar RESET
    btnReset.onclick = () => {
      const txt = prompt('Digite RESET para zerar todas as confirma√ß√µes:');
      if (txt && txt.trim().toUpperCase() === 'RESET') {
        const initial = {};
        names.forEach(n => initial[n] = false);
        dbRef.set(initial).then(() => {
          alert('Lista resetada com sucesso!');
        }).catch((err) => {
          alert('Erro ao resetar (verifique o Firebase).');
          console.error(err);
        });
      } else {
        alert('Reset cancelado.');
      }
    };

    // Caso queira testar sem Firebase (opcional): 
    // Se o Firebase n√£o estiver dispon√≠vel, o c√≥digo acima falhar√° na inicializa√ß√£o do app.
    // Neste caso, abra o console do navegador para ver o erro.
  </script>
</body>
</html>


